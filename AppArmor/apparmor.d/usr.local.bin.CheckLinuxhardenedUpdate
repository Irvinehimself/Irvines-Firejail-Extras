# Last Modified: Tue May 29 06:16:19 2018
# vim:syntax=apparmor
# AppArmor policy for CheckLinuxhardenedUpdate
# Author: irvine mcminn at gmail dot com
# GPL3


/usr/local/bin/CheckLinuxhardenedUpdate flags=(complain) {
  deny ptrace tracedby peer=/usr/lib/gvfs-udisks2-volume-monitor//null-/usr/bin/lsof,

  deny /proc/*/maps r,
  deny /proc/*/stat r,
  deny owner /proc/*/fd/ r,
  deny owner /proc/*/fdinfo/* r,

  /dev/urandom r,
  /etc/ca-certificates/extracted/tls-ca-bundle.pem r,
  /etc/host.conf r,
  /etc/hosts r,
  /etc/ld.so.cache r,
  /etc/ld.so.preload r,
  /etc/nsswitch.conf r,
  /etc/resolv.conf r,
  /etc/ssl/openssl.cnf r,
  /proc/*/net/icmp r,
  /proc/*/net/raw6 r,
  /proc/*/net/sockstat r,
  /proc/*/net/sockstat6 r,
  /proc/*/net/tcp r,
  /proc/*/net/tcp6 r,
  /proc/*/net/udp r,
  /proc/*/net/udp6 r,
  /proc/*/net/udplite r,
  /proc/*/net/udplite6 r,
  /usr/bin/grep mrix,
  /usr/bin/rsstail mrix,
  /usr/bin/sleep mrix,
  /usr/lib/gconv/gconv-modules r,
  /usr/lib/ld-*.so mr,
  /usr/lib/libc-*.so mr,
  /usr/lib/libcom_err.so.* mr,
  /usr/lib/libcrypto.so.* mr,
  /usr/lib/libcurl.so.* mr,
  /usr/lib/libdl-*.so mr,
  /usr/lib/libgssapi_krb5.so.* mr,
  /usr/lib/libidn2.so.* mr,
  /usr/lib/libk5crypto.so.* mr,
  /usr/lib/libkeyutils.so.* mr,
  /usr/lib/libkrb5.so.* mr,
  /usr/lib/libkrb5support.so.* mr,
  /usr/lib/libmrss.so.* mr,
  /usr/lib/libnghttp2.so.* mr,
  /usr/lib/libnss_dns-*.so mr,
  /usr/lib/libnss_files-*.so mr,
  /usr/lib/libnss_myhostname.so.* mr,
  /usr/lib/libnss_mymachines.so.* mr,
  /usr/lib/libnss_resolve.so.* mr,
  /usr/lib/libnxml.so.* mr,
  /usr/lib/libpcre.so.* mr,
  /usr/lib/libpsl.so.* mr,
  /usr/lib/libpthread-*.so mr,
  /usr/lib/libresolv-*.so mr,
  /usr/lib/libssl.so.* mr,
  /usr/lib/libunistring.so.* mr,
  /usr/lib/libz.so.* mr,
  /usr/lib/locale/** r,
  /usr/share/locale/** r,
  /usr/share/zoneinfo/** r,

}
